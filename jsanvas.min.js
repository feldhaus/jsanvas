function Vector2(a,b){this.x=a||0,this.y=b||0}function DisplayObject(a,b){Vector2.call(this,a||0,b||0),this.visible=!0,this.rotation=0,jsanvas.displayObjects.push(this)}function Group(a,b){this.children=[],DisplayObject.call(this,a,b),this._x=a||0,this._y=b||0,this._visible=!0}function ShapeObject(a,b){Group.call(this,a,b),this.fillStyle="white",this.strokeStyle="black",this.lineWidth=1}function Rect(a,b,c,d){ShapeObject.call(this,a,b),this.width=c,this.height=d}function Circle(a,b,c){ShapeObject.call(this,a,b),this.radius=c}function Line(){ShapeObject.call(this),this.lineWidth=1,this.fillStyle=null,this.points=[];for(var a=0;a<arguments.length;a+=2)this.points.push(new Vector2(arguments[a],arguments[a+1]))}function Img(a,b,c,d,e){DisplayObject.call(this,b,c),this.width=d||0,this.height=e||0,parent=this,this.img=new Image,this.img.src=a,this.img.onload=function(){0==parent.width&&(parent.width=parent.img.width),0==parent.height&&(parent.height=parent.img.height),parent.render()}}function Text(a,b,c){DisplayObject.call(this,a,b),this.text=c,this.font="16px Arial",this.align="center"}const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;var jsanvas={};jsanvas.displayObjects=[],Object.defineProperty(jsanvas,"canvasID",{set:function(a){this.canvas=document.getElementById(a),this.context=this.canvas.getContext("2d")}}),Object.defineProperty(jsanvas,"center",{get:function(){return new Vector2(this.width/2,this.height/2)}}),Object.defineProperty(jsanvas,"width",{get:function(){return this.canvas.width}}),Object.defineProperty(jsanvas,"height",{get:function(){return this.canvas.height}}),jsanvas.render=function(){this.context.clearRect(0,0,this.width,this.height);for(var a=0;a<this.displayObjects.length;a++)this.displayObjects[a].visible&&this.displayObjects[a].render()},jsanvas.remove=function(a){var b=this.displayObjects.indexOf(a);-1!=b&&this.displayObjects.splice(b,1)},Vector2.prototype={add:function(a){return a instanceof Vector2?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=a),this},sub:function(a){return a instanceof Vector2?(this.x-=a.x,this.y-=a.y):(this.x-=a,this.y-=a),this},mult:function(a){return a instanceof Vector2?(this.x*=a.x,this.y*=a.y):(this.x*=a,this.y*=a),this},div:function(a){return a instanceof Vector2?(this.x/=a.x,this.y/=a.y):(this.x/=a,this.y/=a),this},equals:function(a){return this.x==a.x&&this.y==a.y},angleTo:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},sqrDistance:function(a){return Vector2.sub(this,a).sqrMagnitude},distance:function(a){return Math.sqrt(this.sqrDistance(a))},clone:function(){return new Vector2(this.x,this.y)},toString:function(){return"Vector2 ("+this.x+", "+this.y+") "}},Object.defineProperty(Vector2.prototype,"sqrMagnitude",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(Vector2.prototype,"magnitude",{get:function(){return Math.sqrt(this.sqrMagnitude)}}),Object.defineProperty(Vector2.prototype,"normalized",{get:function(){var a=this.magnitude;return a>0?this.clone().div(a):Vector2.zero}}),Vector2.add=function(a,b){return b instanceof Vector2?new Vector2(a.x+b.x,a.y+b.y):new Vector2(a.x+b,a.y+b)},Vector2.sub=function(a,b){return b instanceof Vector2?new Vector2(a.x-b.x,a.y-b.y):new Vector2(a.x-b,a.y-b)},Vector2.mult=function(a,b){return b instanceof Vector2?new Vector2(a.x*b.x,a.y*b.y):new Vector2(a.x*b,a.y*b)},Vector2.div=function(a,b){return b instanceof Vector2?new Vector2(a.x/b.x,a.y/b.y):new Vector2(a.x/b,a.y/b)},Vector2.angleBetween=function(a,b){return a.angleTo(b)},Object.defineProperty(Vector2,"zero",{get:function(){return new Vector2}}),DisplayObject.prototype=Object.create(Vector2.prototype),DisplayObject.prototype.removeSelf=function(){jsanvas.remove(this)},DisplayObject.prototype.toBack=function(){this.removeSelf(),jsanvas.displayObjects.unshift(this)},DisplayObject.prototype.toFront=function(){this.removeSelf(),jsanvas.displayObjects.push(this)},DisplayObject.prototype.render=function(){},Group.prototype=Object.create(DisplayObject.prototype),Group.prototype.insert=function(a){a instanceof DisplayObject&&(this.children.push(a),a.x+=this.x,a.y+=this.y)},Object.defineProperty(Group.prototype,"x",{set:function(a){var b=this._x-a;this._x=a;for(var c=0;c<this.children.length;c++)this.children[c].x-=b},get:function(){return this._x}}),Object.defineProperty(Group.prototype,"y",{set:function(a){var b=this._y-a;this._y=a;for(var c=0;c<this.children.length;c++)this.children[c].y-=b},get:function(){return this._y}}),Object.defineProperty(Group.prototype,"visible",{set:function(a){this._visible=a;for(var b=0;b<this.children.length;b++)this.children[b].visible=a},get:function(){return this._visible}}),ShapeObject.prototype=Object.create(Group.prototype),ShapeObject.prototype.draw=function(){this.fillStyle&&(jsanvas.context.fillStyle=this.fillStyle,jsanvas.context.fill()),this.lineWidth>0&&(jsanvas.context.lineWidth=this.lineWidth,jsanvas.context.strokeStyle=this.strokeStyle,jsanvas.context.stroke())},Rect.prototype=Object.create(ShapeObject.prototype),Rect.prototype.render=function(){jsanvas.context.save(),jsanvas.context.translate(this.x,this.y),jsanvas.context.rotate(this.rotation*DEG2RAD),jsanvas.context.beginPath(),jsanvas.context.rect(-this.width/2,-this.height/2,this.width,this.height),this.draw(),jsanvas.context.restore()},Circle.prototype=Object.create(ShapeObject.prototype),Circle.prototype.render=function(){jsanvas.context.beginPath(),jsanvas.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.draw()},Line.prototype=Object.create(ShapeObject.prototype),Line.prototype.render=function(){if(jsanvas.context.beginPath(),this.points.length>1){jsanvas.context.moveTo(this.points[0].x,this.points[0].y);for(var a=1;a<this.points.length;a++)jsanvas.context.lineTo(this.points[a].x,this.points[a].y)}this.draw()},Line.prototype.append=function(){for(var a=0;a<arguments.length;a+=2)this.points.push(new Vector2(arguments[a],arguments[a+1]))},Img.prototype=Object.create(DisplayObject.prototype),Img.prototype.render=function(){jsanvas.context.save(),jsanvas.context.translate(this.x,this.y),jsanvas.context.rotate(this.rotation*DEG2RAD),jsanvas.context.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height),jsanvas.context.restore()},Text.prototype=Object.create(DisplayObject.prototype),Text.prototype.render=function(){jsanvas.context.font=this.font,jsanvas.context.textAlign=this.align,jsanvas.context.fillText(this.text,this.x,this.y)};